<style>
    .nessus-none {
      background-color: #ffffff!important;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }

    .nessus-info {
      background-color: rgb(0, 113, 185)!important;
      color: #fff;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }
    
    .nessus-low {
      background-color: rgb(76, 174, 76)!important;
      color: #fff;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }

    .nessus-medium {
      background-color: rgb(253, 196, 49)!important;
      color: #fff;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }

    .nessus-high {
      background-color: rgb(238, 147, 54)!important;
      color: #fff;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }
    
    .nessus-critical {
      background-color: rgb(212, 63, 58)!important;
      color: #fff;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .05em;
    }
    
    div.content-wrapper {
    display: block;
    padding: 2rem;
    border: 1px;
    background-attachment:scroll;
    background-clip:border-box;
    }

    div.content-wrapper>pre, .observable-report pre {
    display: block;
    color: #000;
    overflow: hidden;
    line-height: 1;
    white-space: pre-line;
    word-wrap: break-word;
    border: none;
    background: none!important;
    padding: 0;
    margin: 0;
    }
    
    div.plugin-details-content h5 {
    font-weight: 700;
    }
    
    div.plugin-details-content div.plugin-wrap{
    line-height: 2rem;
    }
    
    table tr:last-child {
        border-bottom: 0!important;
    }

    table tr {
    vertical-align: top;
    border: 0;
    border-top: 1px solid #ddd;
    }
</style>

<div class="panel panel-danger" ng-if="!success">
    <div class="panel-heading">
        <strong>{{(artifact.data || artifact.attachment.name) | fang}}</strong>
    </div>
    <div class="panel-body">
        {{content.errorMessage}}
    </div>
</div>

<div class="panel panel-info" ng-if="success">
    <div class="panel panel-info">
        <div class="panel-heading"><strong>Results</strong></div>
        <div class="panel-body">
        <p><strong>Results for: </strong>{{content.results[0].host.ip}} <span ng-if="content.results[0].host.name">({{content.results[0].host.name}})</span></p>
        <p ng-if="content.results[0].host.os.full"><strong>Operating system: </strong>{{content.results[0].host.os.full}} ({{content.results[0].host.os.family}})</p>
            <table class="table table-hover" ng-repeat="bucket in content.agg.scan_date.buckets | orderBy:['-bucket.key_as_string'] | limitTo:10">
                <tr> 
                    <td style="padding: 0; text-align:center;"><div class="panel-heading bg-primary"><strong>Scan {{$index+1}}</strong></div></td>
                    <td style="padding: 0; text-align:center;"><div class="panel-heading bg-primary"><strong>{{bucket.key_as_string | date:'medium'}}</strong></div></td>
                    <td style="padding: 0; text-align:center;"><div class="panel-heading bg-primary"><strong>{{bucket.doc_count}} vulnerabilities</strong></div></td>
                </tr>
                <tr ng-repeat="row in content.results | orderBy:['-vulnerability.custom.severity']" ng-if="row.vulnerability.custom.plugin.start_time == bucket.key_as_string">
                    <td ng-class="{'None': 'nessus-info', 'Informational': 'nessus-info', 'Medium': 'nessus-medium', 'High': 'nessus-high', 'Critical':'nessus-critical'}[row.vulnerability.severity]" style="width: 80px;">
                        {{row.vulnerability.severity.replace('None', 'Info')}}
                    </td>
                    <td>
                        <h4>{{row.vulnerability.custom.plugin.name}}</h4>
                        <div class="plugin-details-content">
                            <div ng-if="row.vulnerability.custom.synopsis">
                                <h5>Synopsis</h5>
                                <div class="plugin-wrap">
                                    {{row.vulnerability.custom.synopsis}}
                                </div>
                            </div>
                            <h5>Description</h5>
                            <div class="plugin-wrap">
                                {{row.vulnerability.description}}
                            </div>
                            <h5>Solution</h5>
                            <div class="plugin-wrap">
                                {{row.vulnerability.custom.solution}}
                            </div>
                            <div ng-if="row.vulnerability.reference">
                                <h5>See also</h5>
                                <div class="plugin-wrap">
                                    {{row.vulnerability.reference}}
                                </div>
                            </div>
                            <h5>Output</h5>
                            <div style="border: 1px solid #ddd;">
                                <div class="content-wrapper">
                                    <pre class="monospace">
                                        {{row.vulnerability.custom.plugin.output}}
                                    </pre>
                                </div>
                                <table style="width:100%;font-size: 1.2rem; text-indent: 1rem;">
                                    <tr style="font-weight: 700;">
                                        <th>Protocol</th>
                                        <th>Port</th>
                                        <th>Service</th>
                                        <th>Scanned</th>
                                    </tr>
                                    <tr>
                                        <td>{{row.network.transport}}</td>
                                        <td>{{row.source.port}}</td>
                                        <td>{{row.vulnerability.custom.service}}</td>
                                        <td>{{row.vulnerability.custom.plugin.end_time | date:'medium'}}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                    <td style="width: 300px;">
                        <div class="plugin-details-content">
                            <h4>Plugin Details</h4>
                            <div class="plugin-wrap">
                                 <strong>Severity:</strong> {{row.vulnerability.custom.severity}}/10
                            </div>
                            <div class="plugin-wrap">
                                 <strong>ID:</strong> {{row.vulnerability.custom.plugin.id}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Type:</strong> {{row.vulnerability.custom.plugin.type}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Family:</strong> {{row.vulnerability.category}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Credentialed scan:</strong> {{row.vulnerability.custom.credentialed_scan}}
                            </div>
                            <div class="plugin-wrap" ng-if="row.vulnerability.custom.exploit_available">
                                 <strong>Exploit available:</strong> {{row.vulnerability.custom.exploit_available}}
                            </div>
                            <div class="plugin-wrap" ng-if="row.vulnerability.news">
                                 <strong>In the news:</strong> {{row.vulnerability.news}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Report:</strong> {{row.vulnerability.custom.report_name}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Published:</strong> {{row.vulnerability.custom.plugin.publication_date}}
                            </div>
                            <div class="plugin-wrap">
                                 <strong>Modified:</strong> {{row.vulnerability.custom.plugin.modification_date}}
                            </div>
                            <div ng-if="row.vulnerability.custom.vector">
                                <h4>Risk Information</h4>
                                <div class="plugin-wrap">
                                    <strong>Risk Factor:</strong> {{row.vulnerability.severity}}
                                </div>
                                <div class="plugin-wrap">
                                     <strong>CVSSv3 Base Score:</strong> {{row.vulnerability.score.base}}
                                </div>
                                <div class="plugin-wrap">
                                     <strong>Vector:</strong> {{row.vulnerability.custom.vector}}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <br/>
            </table>
        </div>
    </div>
</div>
